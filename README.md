# B站高质量视频爬虫

## 项目介绍

这是一个用于爬取B站高质量视频的爬虫工具，**现已支持双模式爬取**：
1. **分类排行榜模式**：20个分类，每类最多100视频
2. **热门页面模式**：突破100视频限制，可获取更多数据，上限在32页左右

通过计算视频的点赞率（点赞数/播放数），筛选出点赞率大于0.1的高质量视频数据。

## 功能特点

- 🎯 **双模式爬取**：分类排行榜 + 热门页面，数据更丰富
- 🚀 **突破限制**：热门模式可获取远超100个的高质量视频
- 📊 **质量筛选**：只保留点赞率>0.1的优质视频
- 🛡️ **反爬虫对抗**：合理设置请求头和延时，避免被封
- 📁 **数据组织**：自动分类保存到CSV文件
- ⚙️ **配置灵活**：集中配置管理，便于调整参数

## 支持的分类

**分类排行榜模式（20个分类）**：
全站、番剧、国产动画、国创相关、纪录片、动画、音乐、舞蹈、游戏、知识、科技、运动、汽车、生活、美食、动物圈、鬼畜、时尚、娱乐、影视

**热门页面模式**：
不区分分类，按热门度排序的高质量视频

## 项目结构

```
High_quality_Bilibili/
├── bilibili_crawler.py    # 🚀 分类排行榜爬虫 - 20个分类
├── popular_crawler.py     # 🌟 热门页面爬虫 - 突破100视频限制
├── config.py              # ⚙️ 配置文件 - 爬虫参数设置
├── start.sh               # 🔧 新版启动脚本 - 支持模式选择
├── run.sh                 # 🔧 传统启动脚本 - 分类模式
├── README.md              # 📖 项目说明 - 使用文档
└── data/                  # 📁 数据文件夹 - 存储爬取结果
    ├── ranking/           # 分类排行榜数据目录
    │   └── B站TOP-{分类}-高质量.csv
    └── popular/           # 热门页面数据目录
        └── B站热门-高质量-{时间戳}.csv
```

### 文件说明

| 文件名 | 用途 | 说明 |
|--------|------|------|
| `bilibili_crawler.py` | 分类排行榜爬虫 | 20个分类，每类最多100视频 |
| `popular_crawler.py` | 热门页面爬虫 | 突破100视频限制，可获取更多数据 |
| `config.py` | 配置管理 | 定义爬虫参数、阈值设置、请求头等配置信息 |
| `start.sh` | 新版启动脚本 | 支持模式选择的便捷脚本 |
| `run.sh` | 传统启动脚本 | 仅运行分类排行榜模式 |
| `README.md` | 项目文档 | 详细的项目说明、使用指南和API文档 |
| `data/` | 数据目录 | 存储所有爬取到的高质量视频CSV文件 |

## 使用方法

### 环境要求

```bash
pip install pandas requests
```

### 快速开始

#### 方式1: 新版一键启动（推荐）
```bash
cd High_quality_Bilibili
chmod +x start.sh
./start.sh
```
支持选择：
- 分类排行榜模式 (20分类 × 最多100视频)  
- 热门页面模式 (突破限制，可获取更多数据)
- 同时运行两种模式

#### 方式2: 传统启动脚本
```bash
chmod +x run.sh
./run.sh
```

#### 方式3: 直接运行Python程序
```bash
# 分类排行榜模式
python3 bilibili_crawler.py

# 热门页面模式 (默认500个视频)
python3 popular_crawler.py

# 热门页面模式 (自定义数量)
python3 popular_crawler.py 200
```

## 爬取模式对比

| 模式 | 数据量 | 分类信息 | 优势 | 适用场景 |
|------|--------|----------|------|----------|
| 分类排行榜 | 20类 × 最多100视频 | ✅ 精确分类 | 分类明确，覆盖全面 | 需要分类数据 |
| 热门页面 | 无限制（实测可达500+） | ❌ 无分类 | 数量更多，质量更高 | 大规模数据采集 |

### 配置说明

所有爬虫参数都可以在 `config.py` 中修改：

```python
# 数据质量阈值
LIKE_RATE_THRESHOLD = 0.1        # 点赞率阈值，大于此值认为是高质量视频

# 爬取设置  
TARGET_COUNT_PER_CATEGORY = 100  # 每个分类爬取的目标视频数量
TARGET_COUNT_POPULAR = 500       # 热门页面爬取的目标视频数量
MAX_EMPTY_PAGES = 5              # 连续空页数阈值，超过此数停止爬取
REQUEST_DELAY_MIN = 2            # 请求间隔最小秒数
REQUEST_DELAY_MAX = 4            # 请求间隔最大秒数
REQUEST_TIMEOUT = 10             # 请求超时时间（秒）

# 文件路径
DATA_DIR = "data"                # 数据保存目录
RANKING_DIR = "data/ranking"     # 分类排行榜数据目录
POPULAR_DIR = "data/popular"     # 热门页面数据目录
CSV_PREFIX = "B站TOP"            # CSV文件名前缀

# API设置
BASE_URL = "https://api.bilibili.com"
RANKING_API = "/x/web-interface/ranking/v2"  # 排行榜API
POPULAR_API = "/x/web-interface/popular"     # 热门API
HEADERS = {...}                  # 完整的请求头配置
```

**配置优势**：
- 🎯 **灵活调节**：可根据需求调整点赞率阈值和爬取数量
- ⚡ **性能优化**：可调整请求延时避免被限制
- �️ **智能停止**：连续5页无有效数据时自动停止，避免无效爬取
- �📁 **路径管理**：统一管理文件存储路径和命名规则
- 🔧 **维护简单**：所有参数集中配置，便于维护

### 输出数据格式

CSV文件包含以下字段：
- 视频标题
- 视频地址
- 作者
- 播放数
- 弹幕数
- 投币数
- 点赞数
- 分享数
- 收藏数
- **点赞率**（核心指标）

## 核心算法

### 点赞率计算
```python
点赞率 = 点赞数 / 播放数
```

### 高质量标准
- 点赞率 > 0.1 认为是高质量视频
- 播放数为0的视频会被跳过（避免除零错误）

## 数据示例

| 视频标题 | 作者 | 播放数 | 点赞数 | 点赞率 |
|---------|------|--------|--------|--------|
| 【AI蚊子】恋爱循环 | 阮念゜ | 930575 | 162378 | 0.1745 |
| 拖孩一定觉得自己很酷吧 | 藤圆拖孩er | 212602 | 47225 | 0.2221 |

## 注意事项

1. **请求频率**：程序内置2-4秒随机延时，避免请求过于频繁
2. **网络环境**：需要稳定的网络连接访问B站API
3. **数据时效性**：排行榜数据会实时更新，建议定期重新爬取
4. **依赖安装**：首次运行前请确保安装了pandas和requests库
